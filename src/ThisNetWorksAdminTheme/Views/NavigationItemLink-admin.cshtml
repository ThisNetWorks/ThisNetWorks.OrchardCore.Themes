@{
    // Morphing the shape to keep Model untouched
    Model.Metadata.Alternates.Clear();
    Model.Metadata.Type = "NavigationItemText";
    Model.Metadata.Alternates.Add("NavigationItemText_Id__" + Model.Id);

    TagBuilder linkTag = null;
    TagBuilder chevronTag = null;
    TagBuilder labelTag = new TagBuilder("label");
    labelTag.AddCssClass("item-label");

    var level = (int)Model.Level;
    int paddingLeft = 0;
    if (level > 2)
    {
        paddingLeft = 15 * (level -2);
    }

    if (Model.HasItems)
    {
        chevronTag = new TagBuilder("span");
        chevronTag.Attributes["data-target"] = "#menu-item-" + Model.GetHashCode().ToString();
        chevronTag.Attributes["data-toggle"] = "collapse";
        chevronTag.Attributes["aria-controls"] = Model.GetHashCode().ToString();

        if ((bool)Model.Selected)
        {
            chevronTag.Attributes["aria-expanded"] = "true";
        }
        else
        {
            chevronTag.Attributes["aria-expanded"] = "false";
        }
        chevronTag.TagRenderMode = TagRenderMode.Normal;
        chevronTag.InnerHtml.AppendHtml(Html.Raw("<i class=\"fas fa-chevron-right chevron\"></i>"));

        // Label
        if (String.IsNullOrEmpty(Model.Href) || Model.Href == "#")
        {
            linkTag = Tag(Model, "span");
            linkTag.AddCssClass("item-label");
            linkTag.InnerHtml.AppendHtml(await DisplayAsync(Model));
        }
        else
        {
            linkTag = new TagBuilder("a");
            linkTag.AddCssClass("item-label");
            linkTag.Attributes["href"] = Model.Href ?? "#";
            linkTag.Attributes.Add("style","width:90%;");
            linkTag.TagRenderMode = TagRenderMode.Normal;
            linkTag.InnerHtml.AppendHtml(await DisplayAsync(Model));
        }
    }
    else
    {
        linkTag = Tag(Model, "a");
        linkTag.AddCssClass("item-label w-100");
        linkTag.Attributes["href"] = Model.Href ?? "#";
        linkTag.InnerHtml.AppendHtml(await DisplayAsync(Model));
        labelTag.AddCssClass("last");
    }

}

@labelTag.RenderStartTag()
@if (chevronTag != null)
{
    @chevronTag
}
@if (linkTag != null)
{
    if (linkTag.Attributes.Keys.Contains("style"))
    {
        linkTag.Attributes["style"] = linkTag.Attributes["style"] + " padding-left: " + paddingLeft.ToString() + "px !important";
    } else
    {
        
        linkTag.Attributes.Add("style", "padding-left: " + paddingLeft.ToString() + "px !important");
    }
    @linkTag
}
@labelTag.RenderEndTag()

